# FeedNav Serverless API

åŸºæ–¼ Cloudflare Workers çš„ç¾ä»£åŒ–é¤å»³æœç´¢ APIï¼Œæä¾›å®Œæ•´çš„é¤å»³æœç´¢ã€å¤šç¨®èªè­‰æ–¹å¼ã€ç”¨æˆ¶å€‹äººåŒ–åŠŸèƒ½å’Œæ•¸æ“šåˆ†æã€‚

## âœ¨ åŠŸèƒ½ç‰¹è‰²

- ğŸ” **å¤šé‡èªè­‰ç³»çµ±** - æ”¯æ´å‚³çµ±è¨»å†Š/ç™»å…¥ + OAuth (Google & Discord)
- ğŸ” **æ™ºèƒ½é¤å»³æœç´¢** - å…¨æ–‡æœç´¢ã€å¤šæ¢ä»¶ç¯©é¸ã€åœ°ç†ä½ç½®æœç´¢
- ğŸ“ **é™„è¿‘é¤å»³æŸ¥è©¢** - åŸºæ–¼åœ°ç†ä½ç½®çš„è·é›¢è¨ˆç®—å’Œæ’åº
- â¤ï¸ **æ”¶è—åŠŸèƒ½** - å€‹äººåŒ–é¤å»³æ”¶è—ç®¡ç†
- ğŸ“ **é€ è¨ªè¨˜éŒ„** - ç”¨é¤æ­·å²è¿½è¹¤å’Œçµ±è¨ˆåˆ†æ
- ğŸ·ï¸ **æ™ºèƒ½æ¨™ç±¤ç³»çµ±** - é¤å»³ç‰¹è‰²æ¨™ç±¤åˆ†é¡å’Œç¯©é¸
- ğŸ“Š **å€‹äººåŒ–çµ±è¨ˆ** - ç”¨é¤ç¿’æ…£åˆ†æå’Œæ•¸æ“šæ´å¯Ÿ
- ğŸ‘¥ **ç¤¾äº¤å¸³æˆ¶ç®¡ç†** - å¤šå¹³å°å¸³æˆ¶ç¶å®šå’Œç®¡ç†

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

- **é‹è¡Œæ™‚**: Cloudflare Workers (Edge Computing)
- **æ¡†æ¶**: Hono.js (é«˜æ•ˆèƒ½ Web æ¡†æ¶)
- **æ•¸æ“šåº«**: Cloudflare D1 (åˆ†å¸ƒå¼ SQLite)
- **å¿«å–**: Cloudflare KV (å…¨çƒåˆ†å¸ƒå¼éµå€¼å­˜å„²)
- **å­˜å„²**: Cloudflare R2 (å°è±¡å­˜å„²)
- **èªè¨€**: TypeScript (å®Œæ•´é¡å‹å®‰å…¨)
- **é©—è­‰**: Zod (é‹è¡Œæ™‚é¡å‹é©—è­‰)
- **èªè­‰**: JWT + OAuth 2.0

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Node.js 18+
- Cloudflare å¸³æˆ¶
- Wrangler CLI

### 1. å®‰è£å’Œè¨­ç½®

```bash
# å…‹éš†å°ˆæ¡ˆ
git clone <repository-url>
cd FeedNav-Serverless

# å®‰è£ä¾è³´
npm install

# ç™»å…¥ Cloudflare
wrangler login
```

### 2. å‰µå»º Cloudflare è³‡æº

```bash
# å‰µå»º D1 æ•¸æ“šåº«
wrangler d1 create feednav-db

# å‰µå»º KV å‘½åç©ºé–“
wrangler kv:namespace create "KV"

# å‰µå»º R2 å­˜å„²æ¡¶ (å¯é¸)
wrangler r2 bucket create feednav-assets

# æ›´æ–° wrangler.toml ä¸­çš„ database_id å’Œ KV id
```

### 3. é…ç½®ç’°å¢ƒè®Šæ•¸

#### å¿…éœ€çš„ç’°å¢ƒè®Šæ•¸

```bash
# JWT å¯†é‘° (å»ºè­°ä½¿ç”¨å¼·éš¨æ©Ÿå­—ç¬¦ä¸²)
wrangler secret put JWT_SECRET

# BCrypt åŠ å¯†è¼ªæ•¸ (å¯é¸ï¼Œé è¨­: 10)
wrangler secret put BCRYPT_ROUNDS
```

#### OAuth é…ç½® (å¯é¸ä½†æ¨è–¦)

```bash
# Google OAuth
wrangler secret put GOOGLE_CLIENT_ID
wrangler secret put GOOGLE_CLIENT_SECRET

# Discord OAuth
wrangler secret put DISCORD_CLIENT_ID
wrangler secret put DISCORD_CLIENT_SECRET

# å‰ç«¯ URL (ç”¨æ–¼ OAuth é‡å®šå‘)
wrangler secret put FRONTEND_URL
```

### 4. åˆå§‹åŒ–æ•¸æ“šåº«

```bash
# åŸ·è¡Œæœ¬åœ° schema
wrangler d1 execute feednav-db --local --file=schema.sql

# åŸ·è¡Œç”Ÿç”¢ schema
wrangler d1 execute feednav-db --file=schema.sql
```

### 5. é–‹ç™¼å’Œéƒ¨ç½²

```bash
# æœ¬åœ°é–‹ç™¼
npm run dev

# é¡å‹æª¢æŸ¥
npm run type-check

# éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
npm run deploy:production

# æŸ¥çœ‹æ—¥èªŒ
npm run tail
```

## ğŸ“‹ OAuth è¨­ç½®æŒ‡å—

### Google Cloud Console

1. å‰å¾€ [Google Cloud Console](https://console.cloud.google.com/)
2. å‰µå»ºé …ç›®ä¸¦å•Ÿç”¨ Google+ API
3. å‰µå»º OAuth 2.0 å®¢æˆ¶ç«¯ ID
4. è¨­ç½®é‡å®šå‘ URI: `https://your-worker.workers.dev/api/oauth/google/callback`

### Discord Developer Portal

1. å‰å¾€ [Discord Developer Portal](https://discord.com/developers/applications)
2. å‰µå»ºæ–°æ‡‰ç”¨ç¨‹å¼
3. é…ç½® OAuth2 é‡å®šå‘ URI: `https://your-worker.workers.dev/api/oauth/discord/callback`
4. è¨­ç½® Scopes: `identify` å’Œ `email`

è©³ç´°è¨­ç½®è«‹åƒè€ƒ [OAUTH_SETUP.md](./OAUTH_SETUP.md)

## ğŸ“¡ API ç«¯é»æ¦‚è¦½

### ğŸ” èªè­‰ç³»çµ±

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/api/auth/register` | POST | ç”¨æˆ¶è¨»å†Š | - |
| `/api/auth/login` | POST | ç”¨æˆ¶ç™»å…¥ | - |
| `/api/auth/refresh` | POST | åˆ·æ–° Token | - |
| `/api/auth/logout` | POST | ç”¨æˆ¶ç™»å‡º | - |
| `/api/auth/me` | GET | ç²å–ç”¨æˆ¶è³‡è¨Š | âœ“ |

### ğŸŒ OAuth èªè­‰

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/api/oauth/google` | GET | Google OAuth ç™»å…¥ | - |
| `/api/oauth/discord` | GET | Discord OAuth ç™»å…¥ | - |
| `/api/oauth/accounts` | GET | ç²å–ç¤¾äº¤å¸³æˆ¶ | âœ“ |
| `/api/oauth/accounts/:provider` | DELETE | ç§»é™¤ç¤¾äº¤å¸³æˆ¶ | âœ“ |

### ğŸ½ï¸ é¤å»³æœç´¢

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/api/restaurants/search` | POST | æœç´¢é¤å»³ | å¯é¸ |
| `/api/restaurants/:id` | GET | ç²å–é¤å»³è©³æƒ… | å¯é¸ |
| `/api/restaurants/nearby` | GET | é™„è¿‘é¤å»³æŸ¥è©¢ | å¯é¸ |
| `/api/restaurants/tags` | GET | ç²å–æ‰€æœ‰æ¨™ç±¤ | - |

### â¤ï¸ å€‹äººåŒ–åŠŸèƒ½

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/api/favorites` | GET | ç²å–æ”¶è—åˆ—è¡¨ | âœ“ |
| `/api/favorites` | POST | æ·»åŠ æ”¶è— | âœ“ |
| `/api/favorites/:id` | DELETE | ç§»é™¤æ”¶è— | âœ“ |
| `/api/favorites/check/:id` | GET | æª¢æŸ¥æ”¶è—ç‹€æ…‹ | âœ“ |
| `/api/visits` | GET | ç²å–é€ è¨ªè¨˜éŒ„ | âœ“ |
| `/api/visits` | POST | æ·»åŠ é€ è¨ªè¨˜éŒ„ | âœ“ |
| `/api/visits/:id` | DELETE | ç§»é™¤é€ è¨ªè¨˜éŒ„ | âœ“ |
| `/api/visits/check/:id` | GET | æª¢æŸ¥é€ è¨ªç‹€æ…‹ | âœ“ |
| `/api/visits/stats` | GET | ç²å–é€ è¨ªçµ±è¨ˆ | âœ“ |

è©³ç´° API æ–‡æª”è«‹åƒè€ƒ [docs/API.md](./docs/API.md)

## ğŸ“Š çµ±ä¸€å›æ‡‰æ ¼å¼

### æˆåŠŸå›æ‡‰
```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}
```

### éŒ¯èª¤å›æ‡‰
```json
{
  "success": false,
  "error": "Error Type",
  "message": "éŒ¯èª¤æè¿°"
}
```

### åˆ†é å›æ‡‰
```json
{
  "success": true,
  "data": {
    "restaurants": [...],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 100,
      "totalPages": 5
    }
  }
}
```

## ğŸ—„ï¸ è³‡æ–™åº«æ¶æ§‹

### æ ¸å¿ƒè³‡æ–™è¡¨

- **`restaurants`** - é¤å»³åŸºæœ¬è³‡è¨Š
  - é¤å»³åç¨±ã€åœ°å€ã€è©•åˆ†ã€åƒ¹æ ¼ç­‰ç´š
  - åœ°ç†åæ¨™ (æ”¯æ´åœ°ç†æŸ¥è©¢)
  - ç…§ç‰‡ã€ç¶²ç«™ã€ç‡Ÿæ¥­æ™‚é–“ç­‰è©³ç´°è³‡è¨Š

- **`tags`** - æ¨™ç±¤åˆ†é¡ç³»çµ±
  - æ¨™ç±¤åç¨±ã€åˆ†é¡ã€é¡è‰²
  - æ­£é¢/è² é¢æ¨™ç±¤æ¨™è¨˜

- **`restaurant_tags`** - é¤å»³æ¨™ç±¤é—œè¯
  - å¤šå°å¤šé—œè¯è¡¨

- **`users`** - ç”¨æˆ¶å¸³æˆ¶è³‡è¨Š
  - åŸºæœ¬è³‡è¨Šã€èªè­‰ç‹€æ…‹
  - æ”¯æ´å‚³çµ±è¨»å†Šå’Œ OAuth

- **`social_accounts`** - ç¤¾äº¤å¸³æˆ¶ç¶å®š
  - Googleã€Discord å¸³æˆ¶é—œè¯
  - æä¾›è€…è³‡è¨Šå’Œé ­åƒ

- **`user_favorites`** - ç”¨æˆ¶æ”¶è—
  - å€‹äººåŒ–æ”¶è—ç®¡ç†

- **`user_visited_restaurants`** - é€ è¨ªè¨˜éŒ„
  - ç”¨é¤æ­·å²è¿½è¹¤

- **`reviews`** - è©•è«–ç³»çµ± (é ç•™)
  - ç”¨æˆ¶è©•è«–å’Œè©•åˆ†

## ğŸ”§ é–‹ç™¼æŒ‡ä»¤

```bash
# é–‹ç™¼ç’°å¢ƒ
npm run dev                    # å•Ÿå‹•æœ¬åœ°é–‹ç™¼æœå‹™å™¨
npm run type-check            # TypeScript é¡å‹æª¢æŸ¥

# éƒ¨ç½²ç›¸é—œ
npm run deploy                # éƒ¨ç½²åˆ°é è¨­ç’°å¢ƒ
npm run deploy:production     # éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

# ç›£æ§å’Œé™¤éŒ¯
npm run tail                  # æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ
wrangler d1 execute feednav-db --command="SQL_QUERY"  # åŸ·è¡Œè³‡æ–™åº«æŸ¥è©¢
```

## ğŸ—ï¸ éƒ¨ç½²æ¶æ§‹

```
ç”¨æˆ¶ç«¯ (Web/Mobile)
    â†“
Cloudflare Edge Network (å…¨çƒ 200+ æ•¸æ“šä¸­å¿ƒ)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare Workers (ç„¡ä¼ºæœå™¨é‹ç®—)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ Hono.js API è·¯ç”±                      â”‚
â”‚ â€¢ JWT èªè­‰å’Œæˆæ¬Š                        â”‚
â”‚ â€¢ OAuth 2.0 æ•´åˆ                       â”‚
â”‚ â€¢ æ¥­å‹™é‚è¼¯è™•ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare D1 (åˆ†å¸ƒå¼ SQLite)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ é¤å»³å’Œç”¨æˆ¶è³‡æ–™                        â”‚
â”‚ â€¢ é—œè¯è¡¨å’Œç´¢å¼•                          â”‚
â”‚ â€¢ äº‹å‹™æ”¯æ´                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare KV (éµå€¼å­˜å„²)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ Session ç®¡ç†                          â”‚
â”‚ â€¢ OAuth State æš«å­˜                      â”‚
â”‚ â€¢ å¿«å–è³‡æ–™                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare R2 (å°è±¡å­˜å„²)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ é¤å»³åœ–ç‰‡                              â”‚
â”‚ â€¢ ç”¨æˆ¶é ­åƒ                              â”‚
â”‚ â€¢ éœæ…‹è³‡æº                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **JWT èªè­‰**: ç„¡ç‹€æ…‹çš„å®‰å…¨èªè­‰æ©Ÿåˆ¶
- **OAuth 2.0**: æ”¯æ´ Google å’Œ Discord ç¬¬ä¸‰æ–¹ç™»å…¥
- **CSRF ä¿è­·**: State åƒæ•¸é©—è­‰é˜²æ­¢è·¨ç«™è«‹æ±‚å½é€ 
- **å¯†ç¢¼åŠ å¯†**: BCrypt å®‰å…¨å¯†ç¢¼é›œæ¹Š
- **è¼¸å…¥é©—è­‰**: Zod é‹è¡Œæ™‚é¡å‹æª¢æŸ¥
- **CORS é…ç½®**: è·¨åŸŸè«‹æ±‚å®‰å…¨æ§åˆ¶

## ğŸ“ˆ æ•ˆèƒ½ç‰¹æ€§

- **é‚Šç·£é‹ç®—**: å…¨çƒ 200+ æ•¸æ“šä¸­å¿ƒå°±è¿‘è™•ç†
- **ç„¡å†·å•Ÿå‹•**: Workers å¿«é€Ÿå•Ÿå‹• (~0.5ms)
- **æ™ºèƒ½å¿«å–**: KV å­˜å„²åŠ é€Ÿå¸¸ç”¨æŸ¥è©¢
- **è³‡æ–™åº«å„ªåŒ–**: é©ç•¶ç´¢å¼•å’ŒæŸ¥è©¢å„ªåŒ–
- **åˆ†é æ”¯æ´**: å¤§æ•¸æ“šé›†é«˜æ•ˆè™•ç†

## ğŸ§ª æ¸¬è©¦å’Œç›£æ§

```bash
# å¥åº·æª¢æŸ¥
curl https://your-worker.workers.dev/health

# API æ¸¬è©¦
curl -X POST https://your-worker.workers.dev/api/restaurants/search \
  -H "Content-Type: application/json" \
  -d '{"searchTerm": "ç«é‹"}'

# ç›£æ§æ—¥èªŒ
wrangler tail --env production
```

## ğŸ¤ è²¢ç»æŒ‡å—

1. **Fork æœ¬å°ˆæ¡ˆ**
2. **å‰µå»ºåŠŸèƒ½åˆ†æ”¯**: `git checkout -b feature/amazing-feature`
3. **æäº¤æ›´æ”¹**: `git commit -m 'Add amazing feature'`
4. **æ¨é€åˆ†æ”¯**: `git push origin feature/amazing-feature`
5. **é–‹å•Ÿ Pull Request**

### é–‹ç™¼è¦ç¯„

- ä½¿ç”¨ TypeScript ç¢ºä¿é¡å‹å®‰å…¨
- éµå¾ª ESLint ä»£ç¢¼è¦ç¯„
- ç·¨å¯«å–®å…ƒæ¸¬è©¦ (æ¨è–¦)
- æ›´æ–°ç›¸é—œæ–‡æª”

## ğŸ“„ License

MIT License - è©³è¦‹ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ”— ç›¸é—œé€£çµ

- [Cloudflare Workers æ–‡æª”](https://developers.cloudflare.com/workers/)
- [Hono.js å®˜æ–¹ç¶²ç«™](https://hono.dev/)
- [OAuth è¨­ç½®æŒ‡å—](./OAUTH_SETUP.md)
- [è©³ç´° API æ–‡æª”](./docs/API.md)

---

**FeedNav Serverless API** - ç¾ä»£åŒ–çš„é¤å»³æœç´¢è§£æ±ºæ–¹æ¡ˆ ğŸ½ï¸âœ¨